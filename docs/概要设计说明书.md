# High-Level Design Document / 概要设计说明书

**Project Name / 项目名称:** Conversation Kit Demo  
**Version / 版本:** 1.0  
**Date / 日期:** 2026-02-28  

---

## 1. Introduction / 引言

### 1.1 Purpose / 目的

This document describes the high-level architecture and design decisions for the Conversation Kit Demo.
/ 本文档描述 Conversation Kit Demo 的高层架构和设计决策。

It bridges the gap between requirements specification and detailed design.
/ 它在需求规约和详细设计之间架起桥梁。

### 1.2 Scope / 范围

This document covers:
/ 本文档涵盖：

- System architecture / 系统架构
- Component decomposition / 组件分解
- Data flow design / 数据流设计
- Interface design / 接口设计

### 1.3 References / 引用

- [SRS: docs/需求规约说明书.md](./需求规约说明书.md)
- [SDD: docs/详细设计说明书.md](./详细设计说明书.md)
- [Test Report: docs/测试报告.md](./测试报告.md)

---

## 2. System Architecture / 系统架构

### 2.1 Architectural Style / 架构风格

Conversation Kit adopts a **Component-Based Architecture** with **Composition API** pattern.
/ Conversation Kit 采用基于组件架构和组合式 API 模式。

The architecture follows Vue 3's recommended patterns:
/ 架构遵循 Vue 3 的推荐模式：

- Single File Components (SFC) / 单文件组件 (SFC)
- Composition API for logic reuse / 组合式 API 用于逻辑复用
- Props/Events for component communication / Props/Events 用于组件通信

### 2.2 System Decomposition / 系统分解

```
┌─────────────────────────────────────────────────────────────┐
│                    ConversationKit                          │
│                    对话套件主容器                            │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐    ┌──────────────────────────┐   │
│  │    MessageStream    │    │       SidePanel          │   │
│  │    消息流组件        │    │       侧边栏组件          │   │
│  │                     │    │  ┌────────────────────┐  │   │
│  │  ┌───────────────┐  │    │  │     TreeTab       │  │   │
│  │  │  MessageItem  │  │    │  │    树形标签页      │  │   │
│  │  │   消息项       │  │    │  └────────────────────┘  │   │
│  │  └───────────────┘  │    │  ┌────────────────────┐  │   │
│  │  ┌───────────────┐  │    │  │    SearchTab      │  │   │
│  │  │MarkdownRenderer│  │    │  │    搜索标签页      │  │   │
│  │  │ Markdown渲染器 │  │    │  └────────────────────┘  │   │
│  │  └───────────────┘  │    └──────────────────────────┘   │
│  └─────────────────────┘                                     │
│  ┌─────────────────────┐                                     │
│  │     UserInput       │                                     │
│  │     用户输入         │                                     │
│  └─────────────────────┘                                     │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 Component Responsibilities / 组件职责

| Component / 组件 | Responsibility / 职责 |
|-----------------|----------------------|
| **ConversationKit** | Main container, state management coordination / 主容器，状态管理协调 |
| **MessageStream** | Message list rendering, virtual scrolling / 消息列表渲染，虚拟滚动 |
| **MessageItem** | Single message display, timestamp formatting / 单条消息显示，时间戳格式化 |
| **MarkdownRenderer** | Markdown parsing and HTML rendering / Markdown 解析和 HTML 渲染 |
| **SidePanel** | Sidebar container, tab switching / 侧边栏容器，标签切换 |
| **TreeTab** | Hierarchical tree display, node selection / 层级树显示，节点选择 |
| **SearchTab** | Search input, results display / 搜索输入，结果显示 |
| **UserInput** | Text input, send/stop actions / 文本输入，发送/停止操作 |

---

## 3. Data Design / 数据设计

### 3.1 Data Model / 数据模型

See [Detailed Design Document / 详细设计说明书](./详细设计说明书.md) for complete type definitions.
/ 完整类型定义参见详细设计说明书。

Key entities:
/ 关键实体：

```
Message (消息)
├── id: string              // Unique identifier / 唯一标识
├── role: 'user'|'assistant' // Sender role / 发送者角色
├── content: string         // Message content / 消息内容
├── summary?: string        // Auto-generated summary / 自动生成的摘要
├── headings?: Heading[]    // Extracted headings / 提取的标题
└── timestamp: number       // Creation time / 创建时间

TreeNode (树节点)
├── id: string              // Node identifier / 节点标识
├── type: 'turn'|'chunk'    // Node type / 节点类型
├── summary: string         // Display text / 显示文本
├── anchorId: string        // Navigation anchor / 导航锚点
├── collapsed: boolean      // Expand state / 展开状态
└── children: TreeNode[]    // Child nodes / 子节点
```

### 3.2 State Management / 状态管理

**Approach / 方法:** Pinia Store with Component-level Refs
/ Pinia Store 结合组件级 Refs

**Rationale / 理由:**
- Pinia for global state (search results) / Pinia 用于全局状态（搜索结果）
- Component refs for local state (messages, UI state) / 组件 refs 用于本地状态（消息、UI 状态）

See [SDD Section 4](./详细设计说明书.md#4-state-management--状态管理) for details.
/ 详情参见 SDD 第 4 节。

---

## 4. Interface Design / 接口设计

### 4.1 Component Interfaces / 组件接口

#### ConversationKit Props / 属性

```typescript
// No external props - self-contained component
// 无外部属性 - 自包含组件
```

#### ConversationKit Events / 事件

```typescript
// No external events - internal state management
// 无外部事件 - 内部状态管理
```

#### SidePanel Props / 属性

```typescript
interface SidePanelProps {
  modelValue?: number        // Sidebar width / 侧边栏宽度
  position?: SidePosition    // 'left' | 'right' / 位置
  treeData?: TreeNode[]      // Navigation tree / 导航树
  activeAnchor?: string      // Currently active anchor / 当前激活锚点
}
```

### 4.2 Store Interface / Store 接口

```typescript
// Conversation Store / 对话 Store
interface ConversationStore {
  // State / 状态
  messages: Message[]
  searchResults: SearchResult[]
  activeAnchor: string
  
  // Actions / 动作
  addMessage(message: Omit<Message, 'id' | 'timestamp'>): Message
  search(query: string): void
  setActiveAnchor(anchorId: string): void
}
```

---

## 5. Design Patterns / 设计模式

### 5.1 Composable Pattern / 组合式模式

Logic is extracted into reusable composables:
/ 逻辑提取为可复用的组合式函数：

| Composable / 组合式函数 | Purpose / 用途 |
|------------------------|---------------|
| `useStreamRender` | Streaming message simulation / 流式消息模拟 |
| `useAnchorInject` | Anchor detection and scrolling / 锚点检测和滚动 |
| `useDragResize` | Sidebar resizing / 侧边栏调整大小 |
| `useTreeState` | Tree expand/collapse state / 树展开/折叠状态 |
| `useActiveTab` | Tab switching / 标签切换 |

### 5.2 Props/Events Communication / Props/Events 通信

Parent-child communication follows Vue conventions:
/ 父子通信遵循 Vue 约定：

```
Parent (父) → Props → Child (子)
Child (子) → Events → Parent (父)
```

### 5.3 Provide/Inject (Future) / Provide/Inject (未来)

For deeply nested components, Provide/Inject may be used for:
/ 对于深层嵌套组件，Provide/Inject 可用于：

- Theme configuration / 主题配置
- Internationalization context / 国际化上下文

---

## 6. Technology Stack / 技术栈

| Layer / 层级 | Technology / 技术 | Version / 版本 |
|-------------|-------------------|---------------|
| Framework / 框架 | Vue | 3.5+ |
| Language / 语言 | TypeScript | 5.9+ |
| Build Tool / 构建工具 | Vite | 7.3+ |
| State Management / 状态管理 | Pinia | 3.0 |
| Styling / 样式 | CSS (scoped) | - |

---

## 7. Deployment Architecture / 部署架构

### 7.1 Build Output / 构建输出

```
dist/
├── index.html              # Entry HTML / 入口 HTML
├── assets/
│   ├── index-xxx.js        # Bundled JavaScript / 打包后的 JavaScript
│   └── index-xxx.css       # Bundled CSS / 打包后的 CSS
└── vite.svg                # Static asset / 静态资源
```

### 7.2 Deployment Options / 部署选项

- Static file hosting (CDN, Nginx, Apache)
- 静态文件托管（CDN、Nginx、Apache）
- Embedded in larger Vue applications
- 嵌入到更大的 Vue 应用程序中

---

## 8. Design Decisions / 设计决策

### 8.1 Decision: Component State vs Pinia / 决策：组件状态 vs Pinia

**Decision / 决策:** Use component refs for messages, Pinia for search
/ 消息使用组件 refs，搜索使用 Pinia

**Rationale / 理由:**
- Messages are component-local data / 消息是组件本地数据
- Search results need cross-component access / 搜索结果需要跨组件访问

**Trade-offs / 权衡:**
- (+) Simpler message handling / (+) 更简单的消息处理
- (-) Search state separated from component / (-) 搜索状态与组件分离

### 8.2 Decision: Markdown Parsing Strategy / 决策：Markdown 解析策略

**Decision / 决策:** Custom regex-based parser
/ 自定义基于正则的解析器

**Rationale / 理由:**
- Avoid external dependency / 避免外部依赖
- Sufficient for limited Markdown subset / 对有限的 Markdown 子集足够

**Trade-offs / 权衡:**
- (+) No bundle size increase / (+) 不增加包大小
- (-) Limited Markdown support / (-) Markdown 支持有限

---

## 9. Cross-References / 交叉引用

| Section / 节 | References / 引用 |
|-------------|-------------------|
| Architecture / 架构 | [SDD Section 2](./详细设计说明书.md#2-component-design--组件设计) |
| Data Model / 数据模型 | [SDD Section 3](./详细设计说明书.md#3-data-structures--数据结构) |
| State Management / 状态管理 | [SDD Section 4](./详细设计说明书.md#4-state-management--状态管理) |
| Requirements / 需求 | [SRS Section 3](./需求规约说明书.md#3-functional-requirements--功能需求) |

---

## 10. Change History / 变更历史

| Date / 日期 | Version / 版本 | Changes / 变更 | Author / 作者 |
|-------------|----------------|----------------|---------------|
| 2026-02-28 | 1.0 | Initial HLD / 初始概要设计 | Development Team / 开发团队 |
